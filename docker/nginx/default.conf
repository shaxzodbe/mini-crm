# –§–∞–π–ª: default.conf

# üöÄ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–±–∏—Ä–∞–µ–º –ø–æ—Ä—Ç 9000 –∏–∑ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã server
upstream php_upstream {
    server app; # ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –∏–º—è —Ö–æ—Å—Ç–∞
}

# –†–µ–∑–æ–ª–≤–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è. IP 127.0.0.11 - —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π DNS Docker
resolver 127.0.0.11 valid=5s;

server {
    listen 80;
    server_name localhost;
    root /var/www/html/public;

    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        # ‚úÖ –ü–û–†–¢ 9000 –£–ö–ê–ó–´–í–ê–ï–ú –ó–î–ï–°–¨, –≤–º–µ—Å—Ç–µ —Å –∏–º–µ–Ω–µ–º upstream
        fastcgi_pass php_upstream:9000;

        fastcgi_index index.php;
        fastcgi_buffers 16 16k;
        fastcgi_buffer_size 32k;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\. {
        deny all;
    }
}
